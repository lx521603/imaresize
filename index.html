<!DOCTYPE html>
<html>
<head>
    <title>é«˜è´¨é‡å›¾ç‰‡å‹ç¼©</title>
    <script src="https://cdn.jsdelivr.net/npm/compressorjs@1.2.1/dist/compressor.min.js"></script>
    <style>
        body { font-family: system-ui; padding: 20px; max-width: 800px; margin: 0 auto; }
        .control { margin: 15px 0; }
        label { display: block; margin: 5px 0; }
        input[type="range"] { width: 100%; }
        .preview { display: flex; gap: 20px; margin: 20px 0; }
        .preview img { max-width: 100%; border: 1px solid #ddd; }
        .stats { background: #f5f5f5; padding: 10px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>ğŸ¯ é«˜è´¨é‡å›¾ç‰‡å‹ç¼©</h1>
    
    <input type="file" id="fileInput" accept="image/*">
    
    <div class="control">
        <label>å‹ç¼©è´¨é‡: <span id="qualityValue">90</span>%</label>
        <input type="range" id="quality" min="60" max="95" value="90">
    </div>
    
    <div class="control">
        <label>åˆ†è¾¨ç‡é™åˆ¶: <span id="sizeValue">1920</span>px</label>
        <input type="range" id="maxSize" min="800" max="3840" value="1920" step="160">
    </div>
    
    <div class="control">
        <label>è¾“å‡ºæ ¼å¼:</label>
        <select id="format">
            <option value="jpeg">JPEG (æ¨è)</option>
            <option value="webp">WebP</option>
            <option value="png">PNG</option>
        </select>
    </div>
    
    <button onclick="compress()" style="padding: 10px 20px;">å¼€å§‹å‹ç¼©</button>
    
    <div class="preview">
        <div>
            <h3>åŸå›¾</h3>
            <img id="originalImg">
            <div id="originalStats" class="stats"></div>
        </div>
        <div>
            <h3>å‹ç¼©å</h3>
            <img id="compressedImg">
            <div id="compressedStats" class="stats"></div>
        </div>
    </div>

    <script>
        let currentFile = null;
        
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            currentFile = file;
            const url = URL.createObjectURL(file);
            document.getElementById('originalImg').src = url;
            
            // æ˜¾ç¤ºåŸå›¾ä¿¡æ¯
            const img = new Image();
            img.onload = function() {
                document.getElementById('originalStats').innerHTML = `
                    å°ºå¯¸: ${img.naturalWidth} Ã— ${img.naturalHeight}<br>
                    å¤§å°: ${(file.size / 1024 / 1024).toFixed(2)} MB<br>
                    æ ¼å¼: ${file.type}
                `;
            };
            img.src = url;
        });

        async function compress() {
            if (!currentFile) return alert('è¯·å…ˆé€‰æ‹©å›¾ç‰‡');
            
            const quality = parseInt(document.getElementById('quality').value) / 100;
            const maxSize = parseInt(document.getElementById('maxSize').value);
            const format = document.getElementById('format').value;
            
            try {
                const compressedFile = await new Promise((resolve, reject) => {
                    new Compressor(currentFile, {
                        quality: quality,
                        maxWidth: maxSize,
                        maxHeight: maxSize,
                        mimeType: `image/${format}`,
                        success: resolve,
                        error: reject
                    });
                });
                
                const compressedUrl = URL.createObjectURL(compressedFile);
                document.getElementById('compressedImg').src = compressedUrl;
                
                document.getElementById('compressedStats').innerHTML = `
                    å°ºå¯¸: æœ€å¤§ ${maxSize}px<br>
                    å¤§å°: ${(compressedFile.size / 1024).toFixed(2)} KB<br>
                    æ ¼å¼: ${compressedFile.type}<br>
                    è´¨é‡: ${Math.round(quality * 100)}%<br>
                    èŠ‚çœ: ${((1 - compressedFile.size / currentFile.size) * 100).toFixed(1)}%
                `;
                
                // åˆ›å»ºä¸‹è½½é“¾æ¥
                const a = document.createElement('a');
                a.download = `compressed-${Date.now()}.${format}`;
                a.href = compressedUrl;
                a.textContent = 'ç‚¹å‡»ä¸‹è½½';
                document.getElementById('compressedStats').appendChild(a);
                
            } catch (error) {
                alert('å‹ç¼©å¤±è´¥: ' + error.message);
            }
        }

        // å®æ—¶æ›´æ–°æ˜¾ç¤ºå€¼
        document.getElementById('quality').addEventListener('input', function(e) {
            document.getElementById('qualityValue').textContent = e.target.value;
        });
        
        document.getElementById('maxSize').addEventListener('input', function(e) {
            document.getElementById('sizeValue').textContent = e.target.value;
        });
    </script>
</body>
</html>